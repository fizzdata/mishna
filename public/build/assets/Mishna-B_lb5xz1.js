import{f as o,o as l,h as m,b as t,n as f,t as u,e as g,F as p,k as x,j as k,l as y,d as b}from"./app-CNZwjR9W.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";const w={data(){return{rawData:[],openSeder:null,openMesechta:null,loading:!0,saving:!1,notification:{show:!1,message:"",type:""},selectedPerakim:[],showBulkModal:!1,bulkData:{user_name:"",phone:""}}},props:{family:{type:Object,required:!0}},computed:{groupedData(){if(!this.rawData.length)return[];const s={};return this.rawData.forEach(e=>{s[e.seder_name]||(s[e.seder_name]={name:e.seder_name,mesechtas:[]});let d=s[e.seder_name].mesechtas.find(r=>r.name===e.mesechta_name);d||(d={name:e.mesechta_name,perakim:[]},s[e.seder_name].mesechtas.push(d)),d.perakim.push(e)}),Object.values(s)}},methods:{toggleSeder(s){this.openSeder=this.openSeder===s?null:s,this.openMesechta=null},toggleMesechta(s){this.openMesechta=this.openMesechta===s?null:s},showNotification(s,e="success"){this.notification={show:!0,message:s,type:e},setTimeout(()=>{this.notification.show=!1},3e3)},togglePerekSelection(s){if(this.rawData.find(r=>r.id===s).user_name)return;const d=this.selectedPerakim.indexOf(s);d===-1?this.selectedPerakim.push(s):this.selectedPerakim.splice(d,1)},isPerekSelected(s){return this.selectedPerakim.includes(s)},isMesechtaSelected(s){return s.perakim.every(e=>this.selectedPerakim.includes(e.id))},toggleMesechtaSelection(s){const e=s.perakim.filter(r=>!r.user_name);if(e.length===0)return;e.every(r=>this.selectedPerakim.includes(r.id))?e.forEach(r=>{const i=this.selectedPerakim.indexOf(r.id);i!==-1&&this.selectedPerakim.splice(i,1)}):e.forEach(r=>{this.selectedPerakim.includes(r.id)||this.selectedPerakim.push(r.id)})},mesechtaSummary(s){const e=s.perakim.filter(r=>r.user_name),d=[...new Set(e.map(r=>r.user_name))];return{taken:e.length,available:s.perakim.length-e.length,learners:d}},isMesechtaFullyBooked(s){return this.mesechtaSummary(s).available===0},selectAllInMesechta(s){s.perakim.forEach(e=>{!e.user_name&&!this.selectedPerakim.includes(e.id)&&this.selectedPerakim.push(e.id)})},deselectAllInMesechta(s){s.perakim.forEach(e=>{const d=this.selectedPerakim.indexOf(e.id);d!==-1&&this.selectedPerakim.splice(d,1)})},deselectAll(){this.selectedPerakim=[]},openBulkModal(){this.bulkData={user_name:"",phone:""},this.showBulkModal=!0},closeBulkModal(){this.showBulkModal=!1},async saveBulkPerakim(){if(!this.bulkData.user_name){this.showNotification("ביטע לייגט אריין נאמען פונעם לערנער","error");return}if(!this.bulkData.phone){this.showNotification("ביטע לייגט אריין פאון נאמבער פונעם לערנער","error");return}if(!/^[+]?[0-9]{10,15}$/.test(this.bulkData.phone)){this.showNotification(" די טעלעפאון איר האט אריינגעלייגט איז נישט ריכטיג  ","error");return}if(this.selectedPerakim.length===0){this.showNotification('ביטע קלויב לכה"פ איין פרק',"error");return}try{this.saving=!0;const e=this.selectedPerakim.map(r=>({id:r,user_name:this.bulkData.user_name,phone:this.bulkData.phone}));if(!(await fetch(`/api/${this.family.uid}/store`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw new Error("Network response was not ok");e.forEach(r=>{const i=this.rawData.find(n=>n.id===r.id);i&&(i.user_name=r.user_name,i.phone=r.phone)}),this.showNotification(`נשמרו בהצלחה ${e.length} פרקים!`),this.selectedPerakim=[],this.closeBulkModal(),this.fetchData()}catch(e){console.error("Bulk save error:",e),this.showNotification("טעות ביים אפדעיטן די אויסגעקליבענע","error")}finally{this.saving=!1}},async fetchData(){try{this.loading=!0;const s=await fetch(`/api/${this.family.uid}/perakim`);if(!s.ok)throw new Error("Network response was not ok");this.rawData=await s.json()}catch(s){console.error("Error fetching data:",s),this.showNotification("טעות ביים לאָדן די אינפֿאָרמאַציע","error")}finally{this.loading=!1}}},created(){this.fetchData()}},v={class:"min-h-screen bg-gray-50 py-8 px-4 sm:px-6"},P={class:"max-w-3xl mx-auto bg-white rounded-xl shadow-md overflow-hidden"},M={class:"bg-gradient-to-r from-blue-600 to-indigo-700 p-6 text-center"},S={class:"text-blue-100"},D={key:0,class:"bg-indigo-50 p-4 border-b border-indigo-100"},C={class:"flex flex-wrap items-center justify-between"},B={class:"text-indigo-800 font-medium"},j={class:"bg-indigo-500 text-white px-2 py-1 rounded-full text-sm"},N={class:"flex space-x-2 mt-2 sm:mt-0"},z={key:1,class:"p-8 text-center"},E={key:2,class:"divide-y divide-gray-100"},A=["onClick"],O={class:"text-xl font-bold text-gray-800"},V={class:"flex items-center"},T={class:"mr-3 text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded"},F={key:0,class:"ml-4 mt-2 border-l-2 border-gray-200 pl-4"},H={class:"flex items-center justify-between mb-3"},I={class:"flex items-center"},L=["onClick"],R={class:"ml-2 text-xs font-normal bg-gray-100 px-2 py-1 rounded-full"},U={key:0},q={key:1},J={class:"flex items-center"},G={class:"mr-3 text-sm text-gray-500"},K={key:0,class:"ml-6 border-l-2 border-gray-100 pl-4"},Q={class:"mb-3 flex space-x-2"},W=["onClick"],X=["onClick"],Y={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},Z=["onClick"],$={class:"flex justify-between items-center"},ee={class:"flex items-center"},te={class:"ml-2 font-medium text-gray-700"},se={key:0,class:"text-sm text-green-700 bg-green-100 px-2 py-1 rounded-full"},ie=["checked"],re={key:1,class:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50 p-4"},ne={class:"bg-white rounded-xl shadow-xl w-full max-w-md"},oe={class:"p-6"},le={class:"space-y-4"},ae={class:"pt-4 flex justify-end space-x-3"},de=["disabled"],ce={key:0,class:"flex items-center"},he={key:1,class:"flex items-center"};function ue(s,e,d,r,i,n){return l(),o("div",v,[i.notification.show?(l(),o("div",{key:0,class:f(["fixed top-4 right-4 p-4 rounded-md text-white shadow-lg z-50 transition-all duration-300",i.notification.type==="success"?"bg-green-500":"bg-red-500"])},u(i.notification.message),3)):m("",!0),t("div",P,[t("div",M,[e[7]||(e[7]=t("h1",{class:"text-2xl font-bold text-white mb-2"},"לימוד משניות",-1)),t("p",S,u(d.family.lel||"ברוך ה' זוכים ללמוד משניות בכל יום"),1)]),i.selectedPerakim.length>0?(l(),o("div",D,[t("div",C,[t("div",B,[e[8]||(e[8]=t("span",{class:"mr-2"},"אויסגעקליבן:",-1)),t("span",j,u(i.selectedPerakim.length)+" פרקים",1)]),t("div",N,[t("button",{onClick:e[0]||(e[0]=(...a)=>n.deselectAll&&n.deselectAll(...a)),class:"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-md text-gray-700 transition"}," בטל די אויסוואל "),t("button",{onClick:e[1]||(e[1]=(...a)=>n.openBulkModal&&n.openBulkModal(...a)),class:"px-3 py-1 bg-indigo-600 hover:bg-indigo-700 rounded-md text-white transition flex items-center"},e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),g(" אפדעיט אויסגעקליבענע ")]))])])])):m("",!0),i.loading?(l(),o("div",z,e[10]||(e[10]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"},null,-1),t("p",{class:"mt-4 text-gray-600"},"לאוט משניות...",-1)]))):(l(),o("div",E,[(l(!0),o(p,null,x(n.groupedData,a=>(l(),o("div",{key:a.name,class:"p-4"},[t("div",{onClick:h=>n.toggleSeder(a.name),class:"cursor-pointer flex items-center justify-between py-3"},[t("h2",O,u(a.name),1),t("div",V,[t("span",T,u(a.mesechtas.length)+" מסכתות ",1),t("span",{class:f(["transform transition-transform duration-300 text-gray-500",{"rotate-90":i.openSeder===a.name}])}," ▼ ",2)])],8,A),i.openSeder===a.name?(l(),o("div",F,[(l(!0),o(p,null,x(a.mesechtas,h=>(l(),o("div",{key:h.name,class:"mb-6"},[t("div",H,[t("div",I,[t("h3",{onClick:c=>n.toggleMesechta(h.name),class:"ml-2 cursor-pointer text-lg font-semibold text-gray-700 hover:text-indigo-600"},[g(u(h.name)+" ",1),t("span",R,[n.mesechtaSummary(h).taken>0?(l(),o("span",U,u(n.mesechtaSummary(h).taken)+"/"+u(h.perakim.length)+" גענומען, לומדים: "+u(n.mesechtaSummary(h).learners.join(", ")),1)):(l(),o("span",q,u(h.perakim.length)+" בנימצא ",1))])],8,L)]),t("div",J,[t("span",G,u(h.perakim.length)+" פרקים ",1),t("span",{class:f(["text-gray-500 transform transition-transform duration-300",{"rotate-90":i.openMesechta===h.name}])}," ▼ ",2)])]),i.openMesechta===h.name?(l(),o("div",K,[t("div",Q,[t("button",{onClick:c=>n.selectAllInMesechta(h),class:"text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded"}," קלויב אלע ",8,W),t("button",{onClick:c=>n.deselectAllInMesechta(h),class:"text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded"}," לאזט אפ אלע ",8,X)]),t("div",Y,[(l(!0),o(p,null,x(h.perakim,c=>(l(),o("div",{key:c.id,onClick:me=>!c.user_name&&n.togglePerekSelection(c.id),class:f(["cursor-pointer p-3 rounded-lg border transition-all",{"border-gray-200 hover:border-indigo-300":!c.user_name&&!n.isPerekSelected(c.id),"border-indigo-300 bg-indigo-50":n.isPerekSelected(c.id),"bg-green-50 border-green-200":c.user_name,"cursor-not-allowed opacity-75":c.user_name}])},[t("div",$,[t("div",ee,[t("span",te,u(c.perek),1)]),c.user_name?(l(),o("span",se,u(c.user_name),1)):m("",!0),c.user_name?m("",!0):(l(),o("input",{key:1,type:"checkbox",checked:n.isPerekSelected(c.id),class:"h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500",onClick:e[2]||(e[2]=b(()=>{},["stop"]))},null,8,ie))])],10,Z))),128))])])):m("",!0)]))),128))])):m("",!0)]))),128))]))]),i.showBulkModal?(l(),o("div",re,[t("div",ne,[t("div",oe,[e[15]||(e[15]=t("h2",{class:"text-xl font-bold text-gray-800 mb-4 text-center"},"לייגט אריין דעטאלן",-1)),t("div",le,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1 text-right"},"נאמען פונעם לערנער",-1)),k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>i.bulkData.user_name=a),placeholder:"נאמען פונעם לערנער",class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-right"},null,512),[[y,i.bulkData.user_name]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1 text-right"}," טעלעפאן",-1)),k(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>i.bulkData.phone=a),placeholder:"טעלעפאן",class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-right"},null,512),[[y,i.bulkData.phone]])]),t("div",ae,[t("button",{onClick:e[5]||(e[5]=(...a)=>n.closeBulkModal&&n.closeBulkModal(...a)),class:"px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded-lg text-gray-800 font-medium transition"}," בטל "),t("button",{onClick:e[6]||(e[6]=(...a)=>n.saveBulkPerakim&&n.saveBulkPerakim(...a)),disabled:i.saving,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-medium transition flex items-center disabled:opacity-50"},[i.saving?(l(),o("span",ce,e[13]||(e[13]=[t("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),g(" ווערט אוועק געלייגט... ")]))):(l(),o("span",he,e[14]||(e[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1),g(" שיק ")])))],8,de)])])])])])):m("",!0),e[16]||(e[16]=t("footer",{class:"bg-dark text-white py-12"},[t("div",{class:"container mx-auto px-4"},[t("div",{class:"border-t border-gray-700 mt-8 pt-8 text-center text-gray-400"},[t("p",null,[g("Mishna ©2025 - "),t("a",{href:"http://fizzdata.com"},"Product by and Securely Powered by FizzData.com")])])])],-1))])}const pe=_(w,[["render",ue]]);export{pe as default};
