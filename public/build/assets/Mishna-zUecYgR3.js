import{f as l,o as a,h,b as t,n as f,t as u,e as g,F as p,k as x,j as k,l as y,d as b}from"./app-D0c54OTm.js";import{_}from"./_plugin-vue_export-helper-DlAUqK2U.js";const w={data(){return{rawData:[],openSeder:null,openMesechta:null,loading:!0,saving:!1,notification:{show:!1,message:"",type:""},selectedPerakim:[],showBulkModal:!1,bulkData:{user_name:"",phone:""}}},props:{family:{type:Object,required:!0}},computed:{groupedData(){if(!this.rawData.length)return[];const s={};return this.rawData.forEach(e=>{s[e.seder_name]||(s[e.seder_name]={name:e.seder_name,mesechtas:[]});let r=s[e.seder_name].mesechtas.find(n=>n.name===e.mesechta_name);r||(r={name:e.mesechta_name,perakim:[]},s[e.seder_name].mesechtas.push(r)),r.perakim.push(e)}),Object.values(s)}},methods:{toggleSeder(s){this.openSeder=this.openSeder===s?null:s,this.openMesechta=null},toggleMesechta(s){this.openMesechta=this.openMesechta===s?null:s},showNotification(s,e="success"){this.notification={show:!0,message:s,type:e},setTimeout(()=>{this.notification.show=!1},3e3)},togglePerekSelection(s){if(this.rawData.find(n=>n.id===s).user_name)return;const r=this.selectedPerakim.indexOf(s);r===-1?this.selectedPerakim.push(s):this.selectedPerakim.splice(r,1)},isPerekSelected(s){return this.selectedPerakim.includes(s)},isMesechtaSelected(s){return s.perakim.every(e=>this.selectedPerakim.includes(e.id))},toggleMesechtaSelection(s){const e=s.perakim.filter(n=>!n.user_name);if(e.length===0)return;e.every(n=>this.selectedPerakim.includes(n.id))?e.forEach(n=>{const i=this.selectedPerakim.indexOf(n.id);i!==-1&&this.selectedPerakim.splice(i,1)}):e.forEach(n=>{this.selectedPerakim.includes(n.id)||this.selectedPerakim.push(n.id)})},mesechtaSummary(s){const e=s.perakim.filter(n=>n.user_name),r=[...new Set(e.map(n=>n.user_name))];return{taken:e.length,available:s.perakim.length-e.length,learners:r}},isMesechtaFullyBooked(s){return this.mesechtaSummary(s).available===0},selectAllInMesechta(s){s.perakim.forEach(e=>{!e.user_name&&!this.selectedPerakim.includes(e.id)&&this.selectedPerakim.push(e.id)})},deselectAllInMesechta(s){s.perakim.forEach(e=>{const r=this.selectedPerakim.indexOf(e.id);r!==-1&&this.selectedPerakim.splice(r,1)})},deselectAll(){this.selectedPerakim=[]},openBulkModal(){this.bulkData={user_name:"",phone:""},this.showBulkModal=!0},closeBulkModal(){this.showBulkModal=!1},async saveBulkPerakim(){if(!this.bulkData.user_name){this.showNotification("ביטע לייגט אריין נאמען פונעם לערנער","error");return}if(this.selectedPerakim.length===0){this.showNotification('ביטע קלויב לכה"פ איין פרק',"error");return}try{this.saving=!0;const s=this.selectedPerakim.map(r=>({id:r,user_name:this.bulkData.user_name,phone:this.bulkData.phone}));if(!(await fetch(`/api/${this.family.uid}/store`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Network response was not ok");s.forEach(r=>{const n=this.rawData.find(i=>i.id===r.id);n&&(n.user_name=r.user_name,n.phone=r.phone)}),this.showNotification(`נשמרו בהצלחה ${s.length} פרקים!`),this.selectedPerakim=[],this.closeBulkModal(),this.fetchData()}catch(s){console.error("Bulk save error:",s),this.showNotification("טעות ביים אפדעיטן די אויסגעקליבענע","error")}finally{this.saving=!1}},async fetchData(){try{this.loading=!0;const s=await fetch(`/api/${this.family.uid}/perakim`);if(!s.ok)throw new Error("Network response was not ok");this.rawData=await s.json()}catch(s){console.error("Error fetching data:",s),this.showNotification("טעות ביים לאָדן די אינפֿאָרמאַציע","error")}finally{this.loading=!1}}},created(){this.fetchData()}},v={class:"min-h-screen bg-gray-50 py-8 px-4 sm:px-6"},P={class:"max-w-3xl mx-auto bg-white rounded-xl shadow-md overflow-hidden"},M={class:"bg-gradient-to-r from-blue-600 to-indigo-700 p-6 text-center"},S={class:"text-blue-100"},C={key:0,class:"bg-indigo-50 p-4 border-b border-indigo-100"},D={class:"flex flex-wrap items-center justify-between"},B={class:"text-indigo-800 font-medium"},j={class:"bg-indigo-500 text-white px-2 py-1 rounded-full text-sm"},z={class:"flex space-x-2 mt-2 sm:mt-0"},E={key:1,class:"p-8 text-center"},N={key:2,class:"divide-y divide-gray-100"},A=["onClick"],O={class:"text-xl font-bold text-gray-800"},V={class:"flex items-center"},T={class:"mr-3 text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded"},F={key:0,class:"ml-4 mt-2 border-l-2 border-gray-200 pl-4"},H={class:"flex items-center justify-between mb-3"},I={class:"flex items-center"},L=["onClick"],U={class:"ml-2 text-xs font-normal bg-gray-100 px-2 py-1 rounded-full"},q={key:0},J={key:1},G={class:"flex items-center"},K={class:"mr-3 text-sm text-gray-500"},Q={key:0,class:"ml-6 border-l-2 border-gray-100 pl-4"},R={class:"mb-3 flex space-x-2"},W=["onClick"],X=["onClick"],Y={class:"grid grid-cols-1 sm:grid-cols-2 gap-3"},Z=["onClick"],$={class:"flex justify-between items-center"},ee={class:"flex items-center"},te={class:"ml-2 font-medium text-gray-700"},se={key:0,class:"text-sm text-green-700 bg-green-100 px-2 py-1 rounded-full"},ie=["checked"],re={key:1,class:"fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center z-50 p-4"},ne={class:"bg-white rounded-xl shadow-xl w-full max-w-md"},oe={class:"p-6"},le={class:"space-y-4"},ae={class:"pt-4 flex justify-end space-x-3"},de=["disabled"],ce={key:0,class:"flex items-center"},me={key:1,class:"flex items-center"};function ue(s,e,r,n,i,o){return a(),l("div",v,[i.notification.show?(a(),l("div",{key:0,class:f(["fixed top-4 right-4 p-4 rounded-md text-white shadow-lg z-50 transition-all duration-300",i.notification.type==="success"?"bg-green-500":"bg-red-500"])},u(i.notification.message),3)):h("",!0),t("div",P,[t("div",M,[e[7]||(e[7]=t("h1",{class:"text-2xl font-bold text-white mb-2"},"לימוד משניות",-1)),t("p",S,u(r.family.lel||"ברוך ה' זוכים ללמוד משניות בכל יום"),1)]),i.selectedPerakim.length>0?(a(),l("div",C,[t("div",D,[t("div",B,[e[8]||(e[8]=t("span",{class:"mr-2"},"אויסגעקליבן:",-1)),t("span",j,u(i.selectedPerakim.length)+" פרקים",1)]),t("div",z,[t("button",{onClick:e[0]||(e[0]=(...d)=>o.deselectAll&&o.deselectAll(...d)),class:"px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded-md text-gray-700 transition"}," בטל די אויסוואל "),t("button",{onClick:e[1]||(e[1]=(...d)=>o.openBulkModal&&o.openBulkModal(...d)),class:"px-3 py-1 bg-indigo-600 hover:bg-indigo-700 rounded-md text-white transition flex items-center"},e[9]||(e[9]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4 mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),g(" אפדעיט אויסגעקליבענע ")]))])])])):h("",!0),i.loading?(a(),l("div",E,e[10]||(e[10]=[t("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"},null,-1),t("p",{class:"mt-4 text-gray-600"},"לאוט משניות...",-1)]))):(a(),l("div",N,[(a(!0),l(p,null,x(o.groupedData,d=>(a(),l("div",{key:d.name,class:"p-4"},[t("div",{onClick:m=>o.toggleSeder(d.name),class:"cursor-pointer flex items-center justify-between py-3"},[t("h2",O,u(d.name),1),t("div",V,[t("span",T,u(d.mesechtas.length)+" מסכתות ",1),t("span",{class:f(["transform transition-transform duration-300 text-gray-500",{"rotate-90":i.openSeder===d.name}])}," ▼ ",2)])],8,A),i.openSeder===d.name?(a(),l("div",F,[(a(!0),l(p,null,x(d.mesechtas,m=>(a(),l("div",{key:m.name,class:"mb-6"},[t("div",H,[t("div",I,[t("h3",{onClick:c=>o.toggleMesechta(m.name),class:"ml-2 cursor-pointer text-lg font-semibold text-gray-700 hover:text-indigo-600"},[g(u(m.name)+" ",1),t("span",U,[o.mesechtaSummary(m).taken>0?(a(),l("span",q,u(o.mesechtaSummary(m).taken)+"/"+u(m.perakim.length)+" גענומען, לומדים: "+u(o.mesechtaSummary(m).learners.join(", ")),1)):(a(),l("span",J,u(m.perakim.length)+" בנימצא ",1))])],8,L)]),t("div",G,[t("span",K,u(m.perakim.length)+" פרקים ",1),t("span",{class:f(["text-gray-500 transform transition-transform duration-300",{"rotate-90":i.openMesechta===m.name}])}," ▼ ",2)])]),i.openMesechta===m.name?(a(),l("div",Q,[t("div",R,[t("button",{onClick:c=>o.selectAllInMesechta(m),class:"text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded"}," קלויב אלע ",8,W),t("button",{onClick:c=>o.deselectAllInMesechta(m),class:"text-xs px-2 py-1 bg-gray-100 hover:bg-gray-200 rounded"}," לאזט אפ אלע ",8,X)]),t("div",Y,[(a(!0),l(p,null,x(m.perakim,c=>(a(),l("div",{key:c.id,onClick:he=>!c.user_name&&o.togglePerekSelection(c.id),class:f(["cursor-pointer p-3 rounded-lg border transition-all",{"border-gray-200 hover:border-indigo-300":!c.user_name&&!o.isPerekSelected(c.id),"border-indigo-300 bg-indigo-50":o.isPerekSelected(c.id),"bg-green-50 border-green-200":c.user_name,"cursor-not-allowed opacity-75":c.user_name}])},[t("div",$,[t("div",ee,[t("span",te,u(c.perek),1)]),c.user_name?(a(),l("span",se,u(c.user_name),1)):h("",!0),c.user_name?h("",!0):(a(),l("input",{key:1,type:"checkbox",checked:o.isPerekSelected(c.id),class:"h-4 w-4 text-indigo-600 rounded focus:ring-indigo-500",onClick:e[2]||(e[2]=b(()=>{},["stop"]))},null,8,ie))])],10,Z))),128))])])):h("",!0)]))),128))])):h("",!0)]))),128))]))]),i.showBulkModal?(a(),l("div",re,[t("div",ne,[t("div",oe,[e[15]||(e[15]=t("h2",{class:"text-xl font-bold text-gray-800 mb-4 text-center"},"לייגט אריין דעטאלן",-1)),t("div",le,[t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1 text-right"},"נאמען פונעם לערנער",-1)),k(t("input",{"onUpdate:modelValue":e[3]||(e[3]=d=>i.bulkData.user_name=d),placeholder:"נאמען פונעם לערנער",class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-right"},null,512),[[y,i.bulkData.user_name]])]),t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1 text-right"}," טעלעפאן",-1)),k(t("input",{"onUpdate:modelValue":e[4]||(e[4]=d=>i.bulkData.phone=d),placeholder:"טעלעפאן",class:"w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent text-right"},null,512),[[y,i.bulkData.phone]])]),t("div",ae,[t("button",{onClick:e[5]||(e[5]=(...d)=>o.closeBulkModal&&o.closeBulkModal(...d)),class:"px-4 py-2 bg-gray-300 hover:bg-gray-400 rounded-lg text-gray-800 font-medium transition"}," בטל "),t("button",{onClick:e[6]||(e[6]=(...d)=>o.saveBulkPerakim&&o.saveBulkPerakim(...d)),disabled:i.saving,class:"px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg text-white font-medium transition flex items-center disabled:opacity-50"},[i.saving?(a(),l("span",ce,e[13]||(e[13]=[t("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[t("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),t("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),g(" ווערט אוועק געלייגט... ")]))):(a(),l("span",me,e[14]||(e[14]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-1",viewBox:"0 0 20 20",fill:"currentColor"},[t("path",{"fill-rule":"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z","clip-rule":"evenodd"})],-1),g(" שיק ")])))],8,de)])])])])])):h("",!0),e[16]||(e[16]=t("footer",{class:"bg-dark text-white py-12"},[t("div",{class:"container mx-auto px-4"},[t("div",{class:"border-t border-gray-700 mt-8 pt-8 text-center text-gray-400"},[t("p",null,[g("Mishna ©2025 - "),t("a",{href:"http://fizzdata.com"},"Product by and Securely Powered by FizzData.com")])])])],-1))])}const pe=_(w,[["render",ue]]);export{pe as default};
